$(function(){var t,e,o,i=null,r=null,n=null,a=[],s=0,l=null,c=5,p=15,u=15,v="https://golos.io/",d={black:{min:-100,max:-.1},grey:{min:0,max:.1},fog:{min:.11,max:1},sea:{min:1.1,max:5},green:{min:5.1,max:25},orange:{min:25.1,max:100}},f=new Date,g=f.getFullYear()+"-"+(f.getMonth()+1)+"-"+f.getDate()+"T"+f.getHours()+":"+f.getMinutes()+":"+f.getSeconds(),m=$("#user").val();function h(){m=$("#user").val(),c=$("#post_count").val(),""!==m?(function t(e){golos.api.getDynamicGlobalProperties(function(o,i){null===o?e(i):($("#errors").html(o),t(e))})}(function(n){r=n,function t(e){golos.api.getAccounts([m],function(o,i){null===o?e(i):($("#errors").html(o),t(e))})}(function(n){n.length>0?($("#profile_caption").text(m),i=n,function(){if(i.length>0){o=i[0].vesting_shares.split(" ")[0],$("#gests").html((o/1e6).toFixed(3)),$("#voting_power").html((i[0].voting_power/100).toFixed(2)+"%");var n=JSON.parse(i[0].json_metadata);void 0!==n.profile&&void 0!==n.profile.profile_image?$("#main-avatar").attr("style","background: url(https://imgp.golos.io/100x100/"+n.profile.profile_image+") no-repeat;"):$("#main-avatar").attr("style","background: url(img/blanc.png)  no-repeat;"),$("#reputation").html(F(i[0].reputation)),null!==r&&(t=r.total_vesting_shares.split(" ")[0],e=r.total_vesting_fund_steem.split(" ")[0],$("#power").html((e*(o/t)).toFixed(3))),$("#power").html(y()),$("#level").html('<img src="http://golosboard.com/@'+m+'/level.png" width="65px"/>'),function(){if(null!==r){var t=r.current_supply.split(" ")[0],e=t*u/100,o=y()/t,i=e*p/100;$(".profit-line-box #year-profit").text((i*o).toFixed(3)),$(".profit-line-box #month-profit").text((i*o*30/365).toFixed(3)),$(".profit-line-box #week-profit").text((i*o/52).toFixed(3)),$(".profit-line-box #day-profit").text((i*o/365).toFixed(3)),$(".profit-line-box #hour-profit").text((i*o/8760).toFixed(3))}}()}}()):($(".voter-column, .info-header").hide(),$(".overlay, .pre-loader").remove(),alert("Пользователь не найден"))})}),Promise.all([new Promise(function(t,e){golos.api.getDiscussionsByAuthorBeforeDate(m,"",g,c,function(o,i){null===o?(n=i,t(i)):(console.log(o),e(o))})})]).then(w).then(function(){new Promise(function(t,e){var o="";if(Object.keys(a).length>0){for(var i in a)if(a.hasOwnProperty(i)){var r=x(a[i].curation_rate)+"-palette",n=a[i].upvote_reward.toFixed(2),s=Math.floor(1*a[i].reputation),p=0==a[i].avatar?"img/blanc.png":"https://imgp.golos.io/120x120/"+a[i].avatar,u=(1*a[i].upvote_power_perc).toFixed(0);o+='<div class="grid-item '+r+'" data-link="'+a[i].link+'" data-average_sp="'+u+'" data-upvotes_cnt="'+a[i].cnt+'" data-reward="'+n+'"><div class="grid-item-header"><div class="grid-item-header-text">'+a[i].name+'</div><div class="voter-reputation tooltip" title="Репутация куратора">'+s+'</div></div>  <div class="grid-item-body"><div class="grid-item-vote-cnt"><span class="upvotes-cnt tooltip" title="Количество постов, за которые проголосовал куратор">'+a[i].cnt+'</span><span> из </span><span class="tooltip" title="Количество последних постов, по которым собирается статистика">'+c+'</span></div><div class="grid-item-footer"><div class="tooltip" title="Средняя Сила Голоса, с которой голосует куратор за последние '+a[i].cnt+' пост(ов)"><div> Средняя СГ </div><div class="average-sp"> '+u+'% </div></div><div class="tooltip" title="Количество Золотых, которые принес куратор за последние '+a[i].cnt+' пост(ов)"><div> Всего GBG </div><div class="total-reward">'+n+'</div></div><div class="tooltip" title="Доля куратора в распределении Золотых за последние '+a[i].cnt+' пост(ов)"><div class="total-upvotes-weight"> Общий вес </div><div> '+a[i].curation_rate+'% </div></div></div></div> <div class="img-circle wrap-ava" style="background: url('+p+') no-repeat #ffffff; "></div><div class="img-circle wrap-ava-2" ></div></div>'}var v=""!==$(".grid").html();$(".grid").html(o),v&&$(".grid").isotope("reloadItems"),$(".voter-column, .info-header").show(),l=$(".grid").isotope({itemSelector:".grid-item",percentPosition:!0,layoutMode:"fitRows",getSortData:{reward:"[data-reward] parseFloat",average_sp:"[data-average_sp] parseFloat",upvotes_cnt:"[data-upvotes_cnt] parseFloat"},sortBy:"reward",sortAscending:{reward:!1,upvotes_cnt:!1,average_sp:!1}})}t(1)})}).then(function(){_(!1)}).catch(function(t){$("#errors").html(t)})):($(".voter-column, .info-header").hide(),alert("Введите имя пользователя"))}function _(t){!0===t?($(".voter-column, .info-header").hide(),$("body").before('<div class="overlay"></div><div class="pre-loader"></div>'),$(".dev-label").hide()):($(".dev-label").show(),$(".overlay, .pre-loader").remove(),$(".tooltip").tooltipster())}function w(){return a=[],s=0,new Promise(function(t,e){null!==n&&void 0!==n[0]&&(posts=n,posts.length>0?(posts.forEach(function(t){s+=k(t)}),posts.forEach(function(t){if(void 0!==t.active_votes&&t.active_votes.length>0){var e=function(t){{if("first_payout"==t.mode)return t.abs_rshares;var e=0;return t.active_votes.forEach(function(t){e+=1*t.rshares}),1*t.abs_rshares+e}}(t),o=k(t);t.active_votes.forEach(function(t){void 0===a[t.voter]?a[t.voter]={name:t.voter,rshares:t.rshares,upvote_power_perc:t.percent/100,cnt:1,upvote_reward:b(o,e,t.rshares)}:a[t.voter]={name:t.voter,rshares:1*a[t.voter].rshares+1*t.rshares,upvote_power_perc:((1*a[t.voter].upvote_power_perc+t.percent/100)/2).toFixed(2),cnt:++a[t.voter].cnt,upvote_reward:1*a[t.voter].upvote_reward+b(o,e,t.rshares)}})}}),golos.api.getAccounts(Object.keys(a),function(o,i){null===o?i.length>0&&i.forEach(function(t){t.name in a&&(a[t.name].avatar=function(t){try{if("json_metadata"in t){var e=$.parseJSON(t.json_metadata);if("profile"in e&&"profile_image"in e.profile)return e.profile.profile_image}}catch(t){return!1}return!1}(t),a[t.name].reputation=F(t.reputation),a[t.name].link=v+"@"+t.name,a[t.name].curation_rate=(1*a[t.name].upvote_reward/s*100).toFixed(1))}):($("#errors").html(o),e(new Error(o))),t(a)})):e(new Error("У вас нет постов")))})}function x(t){for(color in d)if(d[color].min<=1*t&&d[color].max>=1*t)return color}function b(t,e,o){return 1*(o/e*t).toFixed(3)}function k(t){return 1*("first_payout"==t.mode?t.total_pending_payout_value:t.total_payout_value).split(" ")[0]}function y(){return null!==r?(t=r.total_vesting_shares.split(" ")[0],((e=r.total_vesting_fund_steem.split(" ")[0])*(o/t)).toFixed(3)):0}function F(t){t+="",isNaN(t)&&(t=0);var e="-"===t.charAt(0);t=e?t.substr(1):t;var o=Math.log10(t);return o=Math.max(o-9,0),(o=9*(o*=e?-1:1)+25).toFixed(2)}golos.config.set("websocket","wss://ws17.golos.io"),$(".tooltip").tooltipster(),$(".settings-submit").on("click",function(){""!==$("#user").val()?(Cookies.set("user",$("#user").val(),{expires:360}),Cookies.set("post_count",$("#post_count").val(),{expires:360}),_(!0),h(),$(".settings-submit").hide()):alert("Введите имя пользователя.")}),$("#user, #post_count").on("focus",function(){$(".settings-submit").show()}),$(".settings-submit").on("click",function(){$(this).hide()}),"null"!==Cookies.get("user")&&void 0!==Cookies.get("user")&&$("#user").val(Cookies.get("user")),$("#filter_form .radio").on("click",function(){null!==l&&l.isotope({sortBy:[$(this).val(),"reward"]})}),"null"!==Cookies.get("post_count")&&void 0!==Cookies.get("post_count")?$("#post_count").val(Cookies.get("post_count")):$("#post_count").val(c),$(".grid").on("click",".grid-item",function(){window.open($(this).data("link"),"_blank")}),""!==$("#user").val()&&(_(!0),h()),setInterval(function(){h()},6e6),$(".dev-label").on("click",function(){window.open("https://golos.io/@elviento","_blank")})});